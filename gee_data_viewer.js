var datasets={
    "(*clear*)": "",
    "PH_Top 10% of service overlap for _PH conservation": {
        fig_title:"Top 10% of service overlap for , PH conservation",
        country:"PH",
        labels:["1 service","2 services","3 services","4 services"],
        visParams:{
            min:1,
            max:4,
            palette:["DCEAB6","B3C169","828434","464A1E"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_four_service_overlap_PH_conservation.tif",
    },
    "PH_Top 10% of service overlap for _PH restoration": {
        fig_title:"Top 10% of service overlap for , PH restoration",
        country:"PH",
        labels:["1 service","2 services","3 services","4 services"],
        visParams:{
            min:1,
            max:4,
            palette:["D0E4D6","9BC8AA","42A16E","008742"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_four_service_overlap_PH_restoration.tif",
    },
    "IDN_Top 10% of service overlap for _IDN conservation": {
        fig_title:"Top 10% of service overlap for , IDN conservation",
        country:"IDN",
        labels:["1 service","2 services","3 services","4 services"],
        visParams:{
            min:1,
            max:4,
            palette:["DCEAB6","B3C169","828434","464A1E"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_four_service_overlap_IDN_conservation.tif",
    },
    "IDN_Top 10% of service overlap for _IDN restoration": {
        fig_title:"Top 10% of service overlap for , IDN restoration",
        country:"IDN",
        labels:["1 service","2 services","3 services","4 services"],
        visParams:{
            min:1,
            max:4,
            palette:["D0E4D6","9BC8AA","42A16E","008742"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_four_service_overlap_IDN_restoration.tif",
    },
    "PH_Sediment retention (Conservation)_Biophysical supply of sediment": {
        fig_title:"Sediment retention (Conservation), Biophysical supply of sediment",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.019886929355561734,
            max:8.875185203552252,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_sediment_PH_conservation_inf.tif",
    },
    "PH_Sediment retention (Conservation)_sediment for downstream people": {
        fig_title:"Sediment retention (Conservation), sediment for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:3.2977083683013935,
            max:9540.0845703125,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_sediment_PH_conservation_inf.tif",
    },
    "PH_Sediment retention (Conservation)_sediment for downstream roads": {
        fig_title:"Sediment retention (Conservation), sediment for downstream roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.07678550481796265,
            max:60.307159423828125,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_sediment_PH_conservation_inf.tif",
    },
    "PH_Sediment retention (Conservation)_Top 10% of priorities for sediment for downstream beneficiaries": {
        fig_title:"Sediment retention (Conservation), Top 10% of priorities for sediment for downstream beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_sediment_PH_conservation.tif",
    },
        "PH_Sediment retention (Restoration)_Biophysical supply of sediment": {
        fig_title:"Sediment retention (Restoration), Biophysical supply of sediment",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.0003426091338042169,
            max:0.9192016363143917,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_sediment_PH_restoration.tif",
    },
    "PH_Sediment retention (Restoration)_sediment for downstream people": {
        fig_title:"Sediment retention (Restoration), sediment for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.14796468913555144,
            max:644.9267578125,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_sediment_PH_restoration.tif",
    },
    "PH_Sediment retention (Restoration)_sediment for downstream roads": {
        fig_title:"Sediment retention (Restoration), sediment for downstream roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.0010559175047092136,
            max:3.963976979255676,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_sediment_PH_restoration.tif",
    },
    "PH_Sediment retention (Restoration)_Top 10% of priorities for sediment for downstream beneficiaries": {
        fig_title:"Sediment retention (Restoration), Top 10% of priorities for sediment for downstream beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_sediment_PH_restoration.tif",
    },
    "IDN_Sediment retention (Conservation)_Biophysical supply of sediment": {
        fig_title:"Sediment retention (Conservation), Biophysical supply of sediment",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:9.340836368210154e-06,
            max:6.041346549987793,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_sediment_IDN_conservation_inf.tif",
    },
    "IDN_Sediment retention (Conservation)_sediment for downstream people": {
        fig_title:"Sediment retention (Conservation), sediment for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.0015414175810292367,
            max:2850.9118164062493,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_sediment_IDN_conservation_inf.tif",
    },
    "IDN_Sediment retention (Conservation)_sediment for downstream roads": {
        fig_title:"Sediment retention (Conservation), sediment for downstream roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.0004800181020982564,
            max:43.53171920776367,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_sediment_IDN_conservation_inf.tif",
    },
    "IDN_Sediment retention (Conservation)_Top 10% of priorities for sediment for downstream beneficiaries": {
        fig_title:"Sediment retention (Conservation), Top 10% of priorities for sediment for downstream beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_sediment_IDN_conservation.tif",
    },
    "IDN_Sediment retention (Restoration)_Biophysical supply of sediment": {
        fig_title:"Sediment retention (Restoration), Biophysical supply of sediment",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.0004887527495156974,
            max:0.7033857822418206,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_sediment_IDN_restoration.tif",
    },
    "IDN_Sediment retention (Restoration)_sediment for downstream people": {
        fig_title:"Sediment retention (Restoration), sediment for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.07437376081943509,
            max:475.1050720214844,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_sediment_IDN_restoration.tif",
    },
    "IDN_Sediment retention (Restoration)_sediment for downstream roads": {
        fig_title:"Sediment retention (Restoration), sediment for downstream roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-0.002507601119577884,
            max:5.723963594436647,
            palette:["ffbd4b","cc720a","8c4e07","4d2b04"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_sediment_IDN_restoration.tif",
    },
    "IDN_Sediment retention (Restoration)_Top 10% of priorities for sediment for downstream beneficiaries": {
        fig_title:"Sediment retention (Restoration), Top 10% of priorities for sediment for downstream beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_sediment_IDN_restoration.tif",
    },
    "IDN_Flood mitigation (Conservation)_Biophysical supply of flood mitigation": {
        fig_title:"Flood mitigation (Conservation), Biophysical supply of flood mitigation",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.12434705644845964,
            max:281.1601318359376,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_flood_mitigation_IDN_conservation_inf.tif",
    },
    "IDN_Flood mitigation (Conservation)_flood mitigation for downstream people": {
        fig_title:"Flood mitigation (Conservation), flood mitigation for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:6.833313131332398,
            max:131346.92968750023,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_flood_mitigation_IDN_conservation_inf.tif",
    },
    "IDN_Flood mitigation (Conservation)_flood mitigation for downstream roads": {
        fig_title:"Flood mitigation (Conservation), flood mitigation for downstream roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.510116231441498,
            max:1574.83935546875,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_flood_mitigation_IDN_conservation_inf.tif",
    },
    "IDN_Flood mitigation (Conservation)_Top 10% of priorities for flood mitigation for downstream beneficiaries": {
        fig_title:"Flood mitigation (Conservation), Top 10% of priorities for flood mitigation for downstream beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_flood mitigation_IDN_conservation.tif",
    },
    "PH_Flood mitigation (Conservation)_Biophysical supply of flood mitigation": {
        fig_title:"Flood mitigation (Conservation), Biophysical supply of flood mitigation",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.048821077123284345,
            max:52.09619140625013,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_flood_mitigation_PH_conservation_inf.tif",
    },
    "PH_Flood mitigation (Conservation)_flood mitigation for downstream people": {
        fig_title:"Flood mitigation (Conservation), flood mitigation for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:19.65305404663086,
            max:56460.701562500006,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_flood_mitigation_PH_conservation_inf.tif",
    },
    "PH_Flood mitigation (Conservation)_flood mitigation for downstream roads": {
        fig_title:"Flood mitigation (Conservation), flood mitigation for downstream roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.15042432993650437,
            max:273.8735382080078,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_flood_mitigation_PH_conservation_inf.tif",
    },
    "PH_Flood mitigation (Conservation)_Top 10% of priorities for flood mitigation for downstream beneficiaries": {
        fig_title:"Flood mitigation (Conservation), Top 10% of priorities for flood mitigation for downstream beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_flood mitigation_PH_conservation.tif",
    },
    "IDN_Flood mitigation (Restoration)_Biophysical supply of flood mitigation": {
        fig_title:"Flood mitigation (Restoration), Biophysical supply of flood mitigation",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:1.7073031663894653,
            max:197.80531311035156,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_flood_mitigation_IDN_restoration.tif",
    },
    "IDN_Flood mitigation (Restoration)_flood mitigation for downstream people": {
        fig_title:"Flood mitigation (Restoration), flood mitigation for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:132.63600769042972,
            max:104510.82968749997,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_flood_mitigation_IDN_restoration.tif",
    },
    "IDN_Flood mitigation (Restoration)_flood mitigation for downstream roads": {
        fig_title:"Flood mitigation (Restoration), flood mitigation for downstream roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:3.4440372467041023,
            max:1009.0708618164062,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_flood_mitigation_IDN_restoration.tif",
    },
    "IDN_Flood mitigation (Restoration)_Top 10% of priorities for flood mitigation for downstream beneficiaries": {
        fig_title:"Flood mitigation (Restoration), Top 10% of priorities for flood mitigation for downstream beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_flood mitigation_IDN_restoration.tif",
    },
    "PH_Flood mitigation (Restoration)_Biophysical supply of flood mitigation": {
        fig_title:"Flood mitigation (Restoration), Biophysical supply of flood mitigation",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.05496995896100998,
            max:31.85562705993658,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_flood_mitigation_PH_restoration.tif",
    },
    "PH_Flood mitigation (Restoration)_flood mitigation for downstream people": {
        fig_title:"Flood mitigation (Restoration), flood mitigation for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:9.927052307128907,
            max:47793.7984375,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_flood_mitigation_PH_restoration.tif",
    },
    "PH_Flood mitigation (Restoration)_flood mitigation for downstream roads": {
        fig_title:"Flood mitigation (Restoration), flood mitigation for downstream roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.07987597137689595,
            max:197.5890686035157,
            palette:["d9fff8","adccc6","778c88","414d4a"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_flood_mitigation_PH_restoration.tif",
    },
    "PH_Flood mitigation (Restoration)_Top 10% of priorities for flood mitigation for downstream beneficiaries": {
        fig_title:"Flood mitigation (Restoration), Top 10% of priorities for flood mitigation for downstream beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_flood mitigation_PH_restoration.tif",
    },
    "IDN_Water recharge (Conservation)_Biophysical supply of water recharge": {
        fig_title:"Water recharge (Conservation), Biophysical supply of water recharge",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-1.6537307601538487e-05,
            max:952.8130493164062,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_recharge_IDN_conservation_inf.tif",
    },
    "IDN_Water recharge (Conservation)_Water recharge for downstream people": {
        fig_title:"Water recharge (Conservation), Water recharge for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:9.03553228378296,
            max:689642.875,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_recharge_IDN_conservation_inf.tif",
    },
    "IDN_Water recharge (Conservation)_Top 10% of priorities": {
        fig_title:"Water recharge (Conservation), Top 10% of priorities",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:['#674ea7', '#a64d79', '#4c1130'],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_top_10th_percentile_service_dspop_recharge_IDN_conservation_inf.tif",
    },
    "PH_Water recharge (Conservation)_Biophysical supply of water recharge": {
        fig_title:"Water recharge (Conservation), Biophysical supply of water recharge",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:0.29493506252765667,
            max:1083.222412109375,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_recharge_PH_conservation_inf.tif",
    },
    "PH_Water recharge (Conservation)_Water recharge for downstream people": {
        fig_title:"Water recharge (Conservation), Water recharge for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:1781.412353515625,
            max:2153800.75,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_recharge_PH_conservation_inf.tif",
    },
    "PH_Water recharge (Conservation)_Top 10% of priorities": {
        fig_title:"Water recharge (Conservation), Top 10% of priorities",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:['#674ea7', '#a64d79', '#4c1130'],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_top_10th_percentile_service_dspop_recharge_PH_conservation_inf.tif",
    },
    "PH_Water recharge (Restoration)_Biophysical supply of water recharge": {
        fig_title:"Water recharge (Restoration), Biophysical supply of water recharge",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-176.74232177734373,
            max:293.62640991210935,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_recharge_PH_restoration.tif",
    },
    "PH_Water recharge (Restoration)_Water recharge for downstream people": {
        fig_title:"Water recharge (Restoration), Water recharge for downstream people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-129433.13906249996,
            max:613016.3312500003,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_recharge_PH_restoration.tif",
    },
    "PH_Water recharge (Restoration)_Top 10% of priorities": {
        fig_title:"Water recharge (Restoration), Top 10% of priorities",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:['#674ea7', '#a64d79', '#4c1130'],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_top_10th_percentile_service_dspop_recharge_PH_restoration.tif",
    },
    "IDN_Water recharge (Restoration)_Biophysical supply of water recharge": {
        fig_title:"Water recharge (Restoration), Biophysical supply of water recharge",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-12.068911743164042,
            max:457.1352233886719,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_diff_recharge_IDN_restoration.tif",
    },
    "IDN_Water recharge (Restoration)_Water recharge for downstream people": {
        fig_title:"Water recharge (Restoration), Water recharge for downstream people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:-4229.993554687499,
            max:616002.4562499993,
            palette:["cfffff","72b1cc","4f7abc","2b424d"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_recharge_IDN_restoration.tif",
    },
    "IDN_Water recharge (Restoration)_Top 10% of priorities": {
        fig_title:"Water recharge (Restoration), Top 10% of priorities",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:['#674ea7', '#a64d79', '#4c1130'],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_top_10th_percentile_service_dspop_recharge_IDN_restoration.tif",
    },
    "IDN_Coastal protection (Conservation)_Coastal protection for coastal people": {
        fig_title:"Coastal protection (Conservation), Coastal protection for coastal people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:6.575969280220306e-08,
            max:2.8044439204677474e-05,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_cv_idn_conservation_inf_result.tif",
    },
    "IDN_Coastal protection (Conservation)_Coastal protection for coastal roads": {
        fig_title:"Coastal protection (Conservation), Coastal protection for coastal roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:6.087822868039439e-08,
            max:3.2395232665294316e-06,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_cv_idn_conservation_inf_result.tif",
    },
    "IDN_Coastal protection (Conservation)_Top 10% of priorities for coastal protection for coastal beneficiaries": {
        fig_title:"Coastal protection (Conservation), Top 10% of priorities for coastal protection for coastal beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_coastal vulnerability_IDN_conservation.tif",
    },
    "PH_Coastal protection (Conservation)_Coastal protection for coastal people": {
        fig_title:"Coastal protection (Conservation), Coastal protection for coastal people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:8.118957225633495e-07,
            max:0.0005746877752244473,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_cv_ph_conservation_inf_result.tif",
    },
    "PH_Coastal protection (Conservation)_Coastal protection for coastal roads": {
        fig_title:"Coastal protection (Conservation), Coastal protection for coastal roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:1.0857266090624762e-07,
            max:6.7061509071209006e-06,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_cv_ph_conservation_inf_result.tif",
    },
    "PH_Coastal protection (Conservation)_Top 10% of priorities for coastal protection for coastal beneficiaries": {
        fig_title:"Coastal protection (Conservation), Top 10% of priorities for coastal protection for coastal beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_coastal vulnerability_PH_conservation.tif",
    },
    "PH_Coastal protection (Restoration)_Coastal protection for coastal people": {
        fig_title:"Coastal protection (Restoration), Coastal protection for coastal people",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:7.315298944376991e-07,
            max:0.000415051297750324,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_cv_ph_restoration_result.tif",
    },
    "PH_Coastal protection (Restoration)_Coastal protection for coastal roads": {
        fig_title:"Coastal protection (Restoration), Coastal protection for coastal roads",
        country:"PH",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:9.615747842417477e-08,
            max:4.734022149932571e-06,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_cv_ph_restoration_result.tif",
    },
    "PH_Coastal protection (Restoration)_Top 10% of priorities for coastal protection for coastal beneficiaries": {
        fig_title:"Coastal protection (Restoration), Top 10% of priorities for coastal protection for coastal beneficiaries",
        country:"PH",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_coastal vulnerability_PH_restoration.tif",
    },
    "IDN_Coastal protection (Restoration)_Coastal protection for coastal people": {
        fig_title:"Coastal protection (Restoration), Coastal protection for coastal people",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:7.904735639385763e-08,
            max:3.984386057709343e-05,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_dspop_cv_idn_restoration_result.tif",
    },
    "IDN_Coastal protection (Restoration)_Coastal protection for coastal roads": {
        fig_title:"Coastal protection (Restoration), Coastal protection for coastal roads",
        country:"IDN",
        labels:["10th percentile","37th percentile","63th percentile","90th percentile"],
        visParams:{
            min:6.663540474960428e-08,
            max:3.1855610131970025e-06,
            palette:["f4cccc","ea9999","e06666","990000"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_service_road_cv_idn_restoration_result.tif",
    },
    "IDN_Coastal protection (Restoration)_Top 10% of priorities for coastal protection for coastal beneficiaries": {
        fig_title:"Coastal protection (Restoration), Top 10% of priorities for coastal protection for coastal beneficiaries",
        country:"IDN",
        labels:["benefiting roads only","benefiting people only","benefiting both"],
        visParams:{
            min:1,
            max:3,
            palette:["674ea7","a64d79","4c1130"],
        },
        remote_path: "gs://ecoshard-root/wwf_sipa_viewer_2024_07_10/cog_combined_percentile_service_coastal vulnerability_IDN_restoration.tif",
    },
};

var default_vector_style = {
    color: 'FFFFFF',
    width: 0.5,
    fillColor: '00000000',
}

var aggregate_polygons = {
    'PH': 'projects/ecoshard-202922/assets/gdam_PH_1',
    'IDN': 'projects/ecoshard-202922/assets/gdam_IDN_1',
}

var mapCenter = {
  'PH': {'lon': 121.77, 'lat': 12.96, 'zoom': 5},
  'IDN': {'lon': 118.01, 'lat': -2.49, 'zoom': 5},
}

var uniqueCountriesSet = new Set();
var uniqueCountries = {};
var datasetByCountry = {};
for (var key in datasets) {
  if (datasets[key] === ''){
    continue;
  }
  if (datasets.hasOwnProperty(key)) {
    var country = datasets[key].country;
    if (!datasetByCountry[country]) {
      datasetByCountry[country] = {};
    }
    datasetByCountry[country][key] = datasets[key];
    if (!uniqueCountriesSet.has(country)) {
      uniqueCountriesSet.add(country);
      uniqueCountries[country] = country;
    }
  }
}

function updateRasterLayer(key, active_context) {
  if (key !== null) {
    active_context.raster = ee.Image.loadGeoTIFF(datasets[key]['remote_path']);
    active_context.raster = active_context.raster.updateMask(
        active_context.raster.gte(datasets[key].visParams.min).and(active_context.raster.lte(datasets[key].visParams.max)));
    active_context.visParams = datasets[key]['visParams'];
    if (active_context.aoi_polygon != null) {
      active_context.raster = active_context.raster.clipToCollection(active_context.aoi_polygon);
    }
    active_context.last_layer = active_context.map.addLayer(
      active_context.raster, active_context.visParams);
    active_context.legendPanel.clear();
    // Add a title to the legend
    var legendTitle = ui.Label({
      value: 'Legend',
      style: {
        fontWeight: 'bold',
        fontSize: '18px',
        margin: '0 0 4px 0',
        padding: '0'
      }
    });
    active_context.legendPanel.add(legendTitle);
    var localPalette = datasets[key]['visParams']['palette'];
    for (var i = 0; i < localPalette.length; i++) {
      var colorBox = ui.Label({
        style: {
          backgroundColor: localPalette[i],
          padding: '8px',
          margin: '0 0 4px 0'
        }
      });
      var description = ui.Label({
        value: datasets[key]['labels'][i],
        style: {
          margin: '0 0 4px 6px'
        }
      });

      var legendItem = ui.Panel({
        widgets: [colorBox, description],
        layout: ui.Panel.Layout.Flow('horizontal')
      });
      active_context.legendPanel.add(legendItem);
    }
    active_context.legendPanel.style().set('shown', true);
  }
}

var linkedMap = ui.Map();
// Center on Philippines
Map.setCenter(122.695894, 4, 5);
var linker = ui.Map.Linker([ui.root.widgets().get(0), linkedMap]);
var splitPanel = ui.SplitPanel({
  firstPanel: linker.get(0),
  secondPanel: linker.get(1),
  orientation: 'horizontal',
  wipe: true,
  style: {stretch: 'both'}
});
ui.root.widgets().reset([splitPanel]);

var panel_list = [];
[[Map, 'left'], [linkedMap, 'right']].forEach(function(mapside, index) {
    var active_context = {
      'last_layer': null,
      'raster': null,
      'point_val': null,
      'last_point_layer': null,
      'last_aoi': null,
      'map': mapside[0],
      'legend_panel': null,
      'visParams': null,
    };

    active_context.map.style().set('cursor', 'crosshair');
    var panel = ui.Panel({
      layout: ui.Panel.Layout.flow('vertical'),
      style: {
        'position': "middle-"+mapside[1],
        'backgroundColor': 'rgba(255, 255, 255, 0.4)'
      }
    });
    // Create the radio button
    var country_selection_label = ui.Label({
      value: 'Active country:',
      style: {
        backgroundColor: 'rgba(0, 0, 0, 0)',
      }
    });
    var countryDatasetPanel = ui.Panel({
      layout: ui.Panel.Layout.flow('vertical'),
      style: {
        'position': "middle-"+mapside[1],
        'backgroundColor': 'rgba(255, 255, 255, 0.4)'
      }
    });

    panel.add(country_selection_label);
    var countrySelectButton = ui.Select({
      items: Object.keys(uniqueCountries),
      onChange: function(selected, self) {
        var country_id = self.getValue();
        active_context.aoi_polygon = ee.FeatureCollection(aggregate_polygons[country_id]);
        Map.setCenter(
          mapCenter[country_id]['lon'],
          mapCenter[country_id]['lat'],
          mapCenter[country_id]['zoom']);
        updateDataselectPanel(active_context, country_id, countryDatasetPanel);
        if (active_context.last_aoi !== null) {
          active_context.map.remove(active_context.last_aoi);
        }
        if (active_context.last_layer !== null) {
        active_context.map.remove(active_context.last_layer);
      }
        active_context.last_aoi = active_context.map.addLayer(
          active_context.aoi_polygon.style(default_vector_style));
      }
    });
    countrySelectButton.setPlaceholder('choose a country ...');
    panel.add(countrySelectButton);
    panel.add(countryDatasetPanel)

    panel_list.push([panel, active_context]);
    active_context.map.add(panel);
    active_context.map.setControlVisibility(false);
    active_context.map.setControlVisibility({"mapTypeControl": true});
});


function updateDataselectPanel(active_context, country_id, panel) {
  panel.clear();
  var select = ui.Select({
    items: Object.keys(datasetByCountry[country_id]),
    onChange: function(raster_key, self) {
      active_context.raster_key = raster_key;
      self.setDisabled(true);
      var original_value = self.getValue();
      self.setPlaceholder('loading ...');
      if (active_context.last_aoi !== null) {
        active_context.map.remove(active_context.last_aoi);
      }
      if (active_context.last_layer !== null) {
        active_context.map.remove(active_context.last_layer);
      }
      if (datasetByCountry[country_id][raster_key] == '') {
        self.setValue(original_value, false);
        self.setDisabled(false);
        return
      }
      updateRasterLayer(raster_key, active_context);
      active_context.last_aoi = active_context.map.addLayer(
        active_context.aoi_polygon.style(default_vector_style));
      self.setValue(original_value, false);
      self.setDisabled(false);
      active_context.point_val.style().set('shown', true);
    }
  });
  active_context.select = select;
  panel.add(select);

  select.setPlaceholder('Choose a dataset...');
  var legendPanel = ui.Panel({
    style: {
      position: 'bottom-left',
      padding: '8px 15px'
    }
  });
  active_context.legendPanel = legendPanel;
  active_context.legendPanel.clear();
  active_context.legendPanel.style().set('shown', false);
  panel.add(legendPanel);

  active_context.point_val = ui.Textbox('click on map to get point value');
  active_context.point_val.setDisabled(true);
  active_context.point_val.style().set('shown', false);
  panel.add(active_context.point_val);
}


panel_list.forEach(function (panel_array) {
  var map = panel_array[1].map;
  map.onClick(function (obj) {
    var point = ee.Geometry.Point([obj.lon, obj.lat]);
    [panel_list[0][1], panel_list[1][1]].forEach(function (active_context) {
      if (active_context.last_layer !== null) {
        active_context.point_val.setValue('sampling...')
        var point_sample = active_context.raster.sampleRegions({
          collection: point,
          //scale: 10,
          //geometries: true
        });
        ee.data.computeValue(point_sample, function (val) {
          if (val.features.length > 0) {
            active_context.point_val.setValue(val.features[0].properties.B0.toString());
            if (active_context.last_point_layer !== null) {
              active_context.map.remove(active_context.last_point_layer);
            }
            active_context.last_point_layer = active_context.map.addLayer(
              point, {'color': '#FF00FF'});
          } else {
            active_context.point_val.setValue('nodata');
          }
        });
      }
    });
  });
});
